---
title: "Web,Cookie,Session,JWT 동작 과정 정리"
date: 2021-08-29
last_modified_at: 2021-08-31
categories:
  - Web
tags:
  - Cookie
  - Session
  - JWT
---

# **Web의 동작 방식**

  1. 사용자가 브라우저에 URL을 입력

  2. 브라우저는 DNS를 통해 서버의 진짜 주소를 찾음 (Domain Name System : 도메인 이름을 IP로 변경해주는 서버)

  3. HTTP로 Request 메세지를 생성함

  4. TCP/IP 연결을 통해 서버로 전송됨

  5. 웹 서버는 HTTP Request에 대한 Response 메세지를 생성함

  6. TCP/IP 연결을 통하여 요청한 컴퓨터로 전송

  7. 도착한 HTTP Response는 웹페이지 데이터로 변환되고, 웹 브라우저에 의해 출력되어 사용자가 봄

# **Cookie**

  - HTTP의 비연결성, 무상태 특성을 보완하기 위해 사용
  - 클라이언트에 저장되는 Key-Value 형태의 데이터 파일
  - 최대 300개 까지 저장가능하며, 유효 시간이 있고, 도메인당 20개 값만 가질 수 있으며, 4KB까지 저장가능
  - ResponseHeader에 Set-Cookie속성을 사용하면 쿠키 생성가능
  - 쿠키는 사용자가 별도로 설정하지 않아도, 브라우저가 Rquest 전송 시 Header에 넣어서 서버에 전송함

# **Cookie 동작방식**

  1. 클라이언트가 페이지 요청
  2. 서버에서 쿠키를 생성
  3. HTTP헤더에 쿠키를 포함시켜 응답
  4. 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있음
  5. 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보냄
  6. 서버에서 쿠키를 읽어 이전상태 정보를 변경 할 필요가 있을 떄 쿠키를 업데이트 하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답



# **Session**

  - 쿠키를 기반으로 하고 있지만, 데이터 파일을 서버에 저장함
  - 클라이언트가 서버에 Request를 보내면 클라이언트에게 고유의 세션ID를 부여하며, 브라우저가 서버에 접속한 후 종료할 떄까지 상태를 유지함
  - 접속 제한 시간을 설정할 수 있으며, 일정 시간 응답이 없을 경우 세션이 해제되도록 설정 가능
  - 세션은 서버 리소스를 사용하므로, 서버 성능에 많은 영향을 미침

  

# **Session 동작방식**

  1. 클라이언트가 서버에 접속 시 세션 ID를 발급받음
  2. 클라이언트는 세션 ID에 대해 쿠키를 사용해서 저장
  3. 클라이언트는 서버에 요청할 때, 이 쿠키의 세션 ID를 서버에 전달해서 사용
  4. 세션 ID를 전달 받은 서버는 세션 ID로 세션에 있는 클라이언트 정보를 가져옴
  5. 클라이언트 정보를 가지고 서버 요청을 처리하여 클라이언트에게 응답함



# **Cookie와 Session의 차이**
  - 쿠키는 클라이언트, 세션은  서버에 저장됨
  - 처리속도는 쿠키가 더 빠름, 세션은 서버에서 처리가 필요하므로 쿠키보다 느림
  - 쿠키는 클라이언트에 저장되어 변질되거나 전송 중 스니핑되어 변조될 수 있으므로 보안상 취약하지만, 세션은 서버에서 처리하므로 보안성이 좋음



# **토큰 기반 인증**

  - 클라이언트에게 토큰을 부여하여, 인증시 토큰 기반으로 사용자 인증을 수행하는 방법

  - Token을 발행해서 클라이언트에 보내주므로, Session

  - JWT(JSON Web ToKen)을 이용함

    

# **토큰 기반 동작 방식**

  1. 사용자가 로그인 함
  2. 서버에서 계정 정보를 읽어 사용자를 확인 후, 사용자의 고유 ID 값을 부여한 후 기타 정보와 함께 Payload에 집어 넣음
  3. JWT 토큰의 유효기간을 설정함
  4. 암호화 할 Secret Key를 이용해 Access Token을 발급
  5. 사용자는 Access Token을 받아 저장 후, 인증이 필요한 요청마다 토큰을 헤더에 싣어 보냄
  6. 서버에서는 해당 토큰의 Verify Signature를 Secret key로 복호화 한 후, 조작여부, 유효 기간을 확인함
  7. 검증이 완료되었을 경우, Payload를 디코딩하여 사용자의 ID에 맞는 데이터를 가져옴
